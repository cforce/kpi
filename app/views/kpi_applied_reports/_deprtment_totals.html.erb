<tr>
<td class="fixed_coll"><b><nobr><%= l(:employees) %> &mdash; <%= @totals[:users][last_department.id] %></nobr></b></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td>
<b><%= kpi_value @totals[:calculated_salary][last_department.id], l(:money_unit_abridgement), false, false, true %></b>
</td>
<% @all_surcharges_names.each do |su| %>
  <td class="align_right">
  <b><%= kpi_value @totals[:surcharges][last_department.id][su.id], l(:money_unit_abridgement), false, false, true  %></b>
  </td>
<% end %>
<td><b><%= kpi_value @totals[:salary_whithout_deduction][last_department.id], l(:money_unit_abridgement), false, false, true  %></b></td>
<td><b><%= kpi_value @totals[:deductions][last_department.id], l(:money_unit_abridgement), false, false, true  %></b></td>
<td class="align_right"><b><%= kpi_value @totals[:salary][last_department.id], l(:money_unit_abridgement), false, false, true  %></b></td>
<td></td>
</tr> 

<tr class="divider">
<td colspan="<%= 12 + @all_surcharges_names.length %>" >

<div class="R kpi_footnote" id="footnote_<%= last_department.id %>">
    <% applied_report = KpiAppliedReport.includes(:user).where("#{KpiAppliedReport.table_name}.date = ? AND #{KpiAppliedReport.table_name}.user_department_id = ? ", @date, last_department.id).try(:first) %>
    <% if not applied_report.nil? %>
      <%= render :partial => 'kpi_applied_reports/approved', :locals => {:applied_report => applied_report, :department_id => last_department} %>
    <% else  %>
      <%= render :partial => 'kpi_applied_reports/approve', :locals => {:department_id => last_department.id, :department_period_state => @department_period_states[last_department.id]} %>
    <% end  %>
</div>

</td>
</tr> 

