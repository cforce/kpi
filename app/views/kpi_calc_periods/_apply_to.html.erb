<div class="splitcontentleft">
<% if @period.users.any? %>
  <table class="list users">
    <thead><tr>
      <th><%= l(:label_user) %></th>
      <th style="width:15%"></th>
      <th style="width:15%"></th>
    </tr></thead>
    <tbody>
    <% @period.kpi_period_users.includes(:user, :kpi_calc_period).sort.each do |kpi_period_user| %>
      <tr id="user-<%= kpi_period_user.id %>" class="<%= cycle 'odd', 'even' %>">
        <td class="user"><%= link_to_user kpi_period_user.user %>
        </td>
        <td><%= user_period_status kpi_period_user %></td>
        <td class="buttons">
          <% if not kpi_period_user.locked %>
            <%= link_to l(:button_delete), {:controller => 'kpi_calc_periods', :action => 'remove_user', :period_user_id =>  kpi_period_user.id}, {:method => :delete, :remote => true, :class => 'icon icon-del'}
             %>
          <% end %>
        </td>
      </tr>
    <% end %>
    </tbody>
  </table>
<% else %>
  <p class="nodata"><%= l(:label_no_data) %></p>
<% end %>
</div>

<div class="splitcontentright">
<% if not @period.locked %>
<% users = User.active.not_in_kpi_period(@period).all(:limit => 100) %>
<% if users.any? %>
  <%= form_for(@period, :remote => true, :url => add_users_kpi_calc_period_path(@period),
               :html => {:method => :post}) do |f| %>
    <fieldset><legend><%=l(:label_user_new)%></legend>
    <p><%= label_tag "applied_user_search", l(:label_user_search) %><%= text_field_tag 'applied_user_search', nil, :class => 'user_search' %></p>

    <%= javascript_tag "observeSearchfield('applied_user_search', 'applied_users', '#{ escape_javascript autocomplete_for_applied_user_kpi_calc_period_path(@period) }')" %>


    <div id="applied_users">
      <%= principals_check_box_tags 'user_ids[]', users %>
    </div>

    <p><%= submit_tag l(:button_add) %></p>
    </fieldset>
  <% end %>
<% end %>
<% end %>

</div>
